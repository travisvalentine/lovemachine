<%= content_for(:header) do %>
  <%= hashtag_meta(@tag.name) %>
  <%= javascript_include_tag "instagram-scroll" %>
<% end %>

<h1><%= @tag.name %></h1>
<% if current_user %>
  <p><%= love_or_unlove_button(@tag) %></p>
<% else %>
  <p><%= link_to "Sign in to love", signin_path %></p>
<% end %>

<ul class="nav nav-tabs">
  <li class="active">
    <a href="#instapane" id="instagrams" data-toggle="tab">Instagrams</a>
  </li>
  <li>
    <a href="#twitterpane" id='tweets' data-toggle="tab">Tweets</a>
  </li>
  <li>
    <a href="#tumblrpane" id='tumbls' data-toggle="tab">Tumbls</a>
  </li>
</ul>

<div class="tab-content">
  <div class="tab-pane fade in active" id="instapane">
    <div id="instas"> </div>
  </div>
  <div class="tab-pane fade in" id="twitterpane">
    <div class="panel panel-default">
      <div id="individual_tweets">
      </div>
    </div>
  </div>
  <div class="tab-pane fade in" id="tumblrpane"> </div>
</div>

<script type="text/javascript">
  $(document).ready(function(){
    return LoadResults();
  });

  $('#tweets').click(function(){
    var tweet_url = "/tweets?tag=<%= @tag.name %>"
    var tweet_getter = $.ajax({type: 'GET', url: tweet_url, dataType: "JSON", contentType: "application/x-www-form-urlencoded; charset=iso-8859-1"})
    tweet_getter.always(function(data){
      items = []
      console.log(data.responseText);
      $.each(data.responseText, function(text) {
        items.push( "<li>" + text + "</li>" );
      });
      $( "<ul/>",
        { "class": "my-new-list", html: items.join( "" )}
      ).appendTo( $('#individual_tweets') );
    });
  });
</script>
